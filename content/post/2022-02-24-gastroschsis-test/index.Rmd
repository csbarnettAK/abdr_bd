---
title: |
 ![](static/ABDR_csr.png "State of Alaska, Department of Health and Human Services, Division of Public Health, Alaska Birth Defects Registry")
author: "Gastroschisis"
date: "Alaska, 2007-2017"
slug: gastroschsis-test
categories: []
tags: []
 

output:
  html_document:
    toc: yes
    toc_float: yes
---


<style type="text/css">

h1.title {
  font-size: 30px;
  color: Black;
  font-weight: bold;
  text-align: center;
}
h4.author { /* Header 4 - and the author and date headers use this too  */
  font-size: 35px;
  font-style: normal;
  font-family: "Times New Roman", Times, seri
  color: Black;
  text-align: center;
}
h4.date { /* Header 4 - and the author and date headers use this too  */
  font-size: 25px;
  font-family: "Times New Roman", Times, serif;
  color: Black;
  text-align: center;
}
</style>

---
## Background 

Gastroschisis, like [omphalocele](https://rpubs.com/AK_ABDR/574095), is a birth defect in the abdominal wall that causes a newborn's intestines and sometimes other organs (e.g. stomach and liver) to protrude outside of the baby's body, usually through a hole next to the belly button. This condition occurs when the muscles that make up the baby's abdominal wall do not form correctly, which happens early in the pregnancy. Unlike omphalocele, the organs that are pushed outside the body are not enveloped in a sac or membrane, but rather completely exposed to the surrounding environment. The organs are therefore immersed in the amniotic fluid, which can cause swelling or irritation. Surgery is necessary after birth to put the exposed organs back inside the body. However, even after repair infants may still have problems with feeding, digestion of food, and absorption of nutrients.They may need treatments such as intravenous fluids, antibiotics to prevent infection, and careful monitoring of their body temperature.[[1]](#references)  

The causes of gastroschisis are unknown and most likely a combination of genetics and the environment. However, certain risk factors, including young maternal age and alcohol and tobacco use during pregnancy, have been shown to increase the chances of having a child with gastroschisis.[[2,3,4]](#references)  


## Epidemiology 
Alaska Birth Defects Registry (ABDR) registers birth defects as reported from health care providers using International Classification of Disease (ICD) billing codes. The use of these ICD codes can lead to misclassification of diagnosed conditions. Prior to this report, all prevalence estimates were based on the number of unique children reported to ABDR with an ICD code representing a specified condition regardless of case confirmation status.  

The estimates in this report were derived by conducting medical record review and case confirmation of a random sample of cases of the condition reported to ABDR. The confirmation probability from the sample was used to develop informed estimates of the actual diagnosed defect prevalence. [See Defect prevalence calculation](#defect-prevalence-calculation).      

For explanations of table columns [see Column descriptions](#column-descriptions). 

### Prevalence   
Gastroschisis occurs in **4.5 out of every 10,000 live births in the United States.** This results in about 1,871 babies diagnosed with gastroschisis nationally each year.[[5]](#references)  


```{r,echo=FALSE,warning=FALSE,comment=NA,message=FALSE}
options(width=150)
library(epitools)
library(lubridate)  
library(RODBC)
library(dplR)
library(plyr)
library(shiny)
library(knitr)
library(pander)
library(htmlTable)
library(htmltools)
library(tidyverse)
library(haven)
library(dplyr)
library(janitor)
library(DT)
# Removing scientific notation
options(scipen=999)

```

```{r warning=FALSE, comment=NA,message=FALSE,echo=FALSE}
#channel.c<-odbcDriverConnect("Driver={Microsoft Access Driver (*.mdb, *.accdb)};
 #                            DBQ=R:\\ABDR\\Analysis_New\\ABDR_CASECONF\\CaseConfProb.accdb")
#CPROB<-subset(sqlQuery(channel.c,"SELECT * FROM CaseConfProb1")) 

#load current ABDR,BVS, & Conf files: update these files each year
load("R:/ABDR/Research_Data_tables/ResearchTables2007_2017/ABDR_BTH_0717RSRCH_L3.Rda") #

# Loading Birth Certificate data
load("R:\\ABDR\\Research_Data_tables\\ResearchTables2007_2017\\bth07_17.Rda")   #

# Loading ABDR data with NatCond variable
load("R:\\ABDR\\Research_Data_tables\\ResearchTables2007_2017\\ABDR_0717YOR_YOB.Rda") #

# Conf files
load("R:\\ABDR\\Analysis_New\\ABDR_CASECONF\\CPROB.Rda") 

CPROB$NatCond<-as.character(CPROB$NatCond)
CPROB$NatCond[CPROB$NatCond=="GASTR"]<-"GAS"
#Function to Create condition specific dataset from the ABDR and bth files
  DAT<-function(DCODE,ABDRdata,VSdata){
  cdton<-ddply(subset(ABDRdata,NatCond==DCODE & age_y<3),.(BC),summarise,FYOB=min(YOB))
    dta<-join(VSdata,cdton,by='BC',type='left',match='first') 
    dta$CD<-with(dta,ifelse(is.na(FYOB),0,1)) 
    dta<-dta[which(!is.na(dta$PH_REGION)),] #Resident mothers only
  }
  
#Specify the National Condition Code to be used
  code<-"GAS"
#Create a label for the condition to be used
  condition<-("gastroschisis")
#Specify the condition specific dataset for the condition report
  CDATA<-as.data.frame(DAT(code,ABDR_0717YOR_YOB,bth07_17))                     #
#Specify the years of these data
  datYRS<-("2007-2017")                                                         #
#Specify the row-names for moving averages
 rnames=c("2007-2009","2008-2010","2009-2011","2010-2012","2011-2013",
          "2012-2014", "2013-2015", "2014-2016", "2015-2017")                   #
  
### Condition Specific Report coding ####
### Create Prevalence estimates by year
  ev<-addmargins(table(CDATA[,"CD"]==1,year(CDATA[,"dob"]),useNA = "always"))
  ev<-ev[-3,][,-c(length(colnames(ev))-1)] #remove the NA values from the summary table
  row.names(ev)<-c("NoDefect","Defect","Total")
  cp<-subset(CPROB,NatCond==code ,select=c("NatCond","ReportsSens","Confirmed","PPV","NPV"))
  Rrate<-ev[2,]/ev[3,] #Reported prevalence rate by year
 # estimated Prevalence
  temp1<-((Rrate)*cp$PPV)+((1-(Rrate))*(1-cp$NPV)) #Bayes adjusted prevalence rate
    ev1<-pois.exact(temp1*ev[3,],ev[3,]) #Obtain CI's
    ev1[,3:5]<-round(ev1[,3:5]*10000,1)
    ev1[,1]<-round(ev1[,1],1)
    ev2<-cbind(ev[2,],ev1[,-6])
    ev2<-format(round(ev2,1),trim=T,justify="centre",drop0trailing=F)
    ev2$`Prevalence (95% CI)`<-paste(ev2[,4],paste("(",ev2[,5],","," ",ev2[,6],")",sep = ""))
    #ev2$`Prevalence (95% CI)`<-sprintf("%1.1f (%1.1f, %1.1f)",ev2[,4],ev2[,5],ev[,6])
    colnames(ev2)<-c("Reports","Defects","Births","Defect Prevalence","LowerCI","UpperCI", "Prevalence (95% CI)")
    rownames(ev2)<-c(min(year(CDATA[,"dob"])):max(year(CDATA[,"dob"])),"Total")
    ev2$yrs<-c(min(year(CDATA[,"dob"])):max(year(CDATA[,"dob"])),NA)

    #ev2 Prevalence estimate table

```
  
   
In Alaska, during `r datYRS[1]`, the prevalence of `r condition[1]` was **`r ev2[max(row.names(ev2)),4]` per 10,000 live births**. 
<center>
```{r warning=FALSE, comment=NA,message=FALSE,echo=FALSE,results="asis"}
library(htmlTable)
# tmp_a <- ev2[max(length(row.names(ev2))),-c(4:6,8)]
# 
# tmp_b <- htmlTable(tmp_a, css.cell="padding-left: 2em; padding-right: 2em;",
#           tfoot="Notes: 95% CI = 95% Confidence Interval")
# gsub('<td','<td nowrap="nowrap";',tmp_b) #removes wrapping
# 
# datatable(tmp_a, container = tmp_b, rownames = T)

tmp<-htmlTable(ev2[max(length(row.names(ev2))),-c(4:6,8)],
          css.cell="padding-left: 2em; padding-right: 2em;",
          tfoot="Notes: 95% CI = 95% Confidence Interval")
gsub('<td','<td nowrap="nowrap";',tmp) #removes wrapping
```  


### Trend 
Prevalence per 10,000 births of `r condition[1]` during `r datYRS[1]` by three-year moving averages, with 95% confidence interval band and Poisson estimated fitted line.
<center>
```{r warning=FALSE, echo=FALSE, message=FALSE, fig.width = 9, fig.height = 6, align}
library(ggplot2)
library(plotly)

ev2 <- ev2 %>% mutate_all(.funs = as.numeric) 

#Create moving average trend plot#
tndP<-as.data.frame(stats::filter(ev2[1:max(length(row.names(ev2)))-1,],
                           rep(1/3,3),sides=1))
tndP<-tndP[,-7]
tndPa <- tndP[complete.cases(tndP), ]
#tndPa<-na.omit(tndP)
  g1<-(glm(V2~V8,family=quasipoisson(link="log"),offset=log(V3),tndPa))
  Poisson<-summary(g1)
  tndPa$Fitted_rate<-((fitted(g1))/tndPa$V3)*10000
ul<-round_any(max(tndPa[,6]),5,f=ceiling)
tndPa2 <- tndPa %>%
  mutate_at(vars(-"V8"), funs(round(., digits = 1)))
i<-ggplot(tndPa2 ,aes(x = V8,y = V4))
ii <- i+ggplot2::geom_ribbon(aes(x=V8,ymin=V5,ymax=V6),fill='lightblue4',alpha=0.2)+
  ggplot2::geom_line(aes(y=V4,color="V4",linetype="V4"))+
  ggplot2::geom_point(aes(V8,V4)) + 
               ggplot2::geom_point(aes(text = paste(
                                     "<br>Prevalence: ",V4,
                                     "<br>Lower CI: ",V5,
                                     "<br>Upper CI: ",V6)),
             size = 2, color = "#0a306a") +
  ggplot2::geom_line(aes(y=Fitted_rate,color="Fitted_rate",linetype="Fitted_rate"))+
  ggplot2::theme_minimal() +    
  ggplot2::scale_linetype_manual("",values=c("V4"=1,"Fitted_rate"=2))+
    ggplot2::scale_color_manual("",
                       breaks = c("Fitted_rate","V4"),
                       values = c("V4"="black","Fitted_rate"="red"),
                       labels = c("Predicted Prevalence","Observed Prevalence"))+
    ylab("Prevalence per 10,000 births")+
    xlab("Grouped years")+
    theme(legend.position="bottom", 
          axis.title=element_text(size=10))+guides(fill="none")+
    scale_x_continuous(breaks = c(tndPa$V8), labels=c(rnames))+
    scale_y_continuous(limits=c(0,ul))

ggplotly(ii, tooltip = c("text")) %>%
  layout(legend = list(orientation = "h", x = 0.4, y = -0.2))

#Create moving average Trend Table #
tblPa<-format(round(tndPa,1),trim=T,justify="centre",drop0trailing=F)
  tblPa$`Prevalence (95% CI)`<-paste(tblPa[,4],paste("(",tblPa[,5],","," ",tblPa[,6],")",sep = ""))
    colnames(tblPa)<-c("Reports","Defects","Births","Defect Prevalence","LowerCI","UpperCI","Year","Predicted Prevalence","Prevalence (95% CI)")
    row.names(tblPa)<-c(rnames)
  tblPa<-tblPa[c(1:6,9,8)]


  tmp_a <- tblPa[,-c(4:6)]
  
  tmp_b <- htmlTable(tmp_a,
          css.cell="padding-left: 2em; padding-right: 2em;",
          header=c("Reports","Defects","Births","Prevalence (95% CI)","Predicted Prevalence&dagger;"),
          tfoot=txtMergeLines("Notes: Each row is based on three-year moving averages; Prevalence reported per 10,000 live births; 95% CI=95% Confidence Interval", "&dagger; Estimated rate based on Poisson model"))
  
  datatable(tmp_a, container = tmp_b, rownames = T)
  
#   tmp<-htmlTable(tblPa[,-c(4:6)],
#           css.cell="padding-left: 2em; padding-right: 2em;",
#           header=c("Reports","Defects","Births","Prevalence (95% CI)","Predicted Prevalence&dagger;"),
#           tfoot=txtMergeLines("Notes: Each row is based on three-year moving averages; Prevalence reported per 10,000 live births; 95% CI=95% Confidence Interval", "&dagger; Estimated rate based on Poisson model"))
# 
# gsub('<td','<td nowrap="nowrap";',tmp) #removes wrapping
``` 


</center>
The p-value test for trend detected no significant increase or decrease in the number of live births with `r condition[1]` during `r datYRS[1]`. See [p-value estimate](#p-value-estimate)
<center>
```{r warning=FALSE, echo=FALSE}
  PSN<-summary(g1)

# tmp_a <- txtRound(t(data.matrix(PSN$coefficients[2,])),5)
# 
# tmp_b <- htmlTable(tmp_a,
#           css.cell="padding-left: 2em; padding-right: 2em;")
# gsub('<td','<td nowrap="nowrap";',tmp_b) #removes wrapping)
# 
# datatable(tmp_a, container = tmp_b, rownames = T)

  tmp<-htmlTable(txtRound(t(data.matrix(PSN$coefficients[2,])),5),
          css.cell="padding-left: 2em; padding-right: 2em;")
gsub('<td','<td nowrap="nowrap";',tmp) #removes wrapping

```  
 
   
</center>   
### Regional Distribution
Distribution of `r condition[1]` in Alaska by Public Health Region of maternal residence at the time of birth. [A description of regional breakdowns can be found here](http://dhss.alaska.gov/dph/InfoCenter/Pages/ia/brfss/geography.aspx). Data suppressed for # of reports  < 6.   

```{r,echo=FALSE,warning=FALSE,comment=NA,message=FALSE}
options(width=150)
library(epitools)
library(lubridate)  
library(RODBC)
library(dplR)
library(plyr)
library(shiny)
library(knitr)
library(pander)
library(htmlTable)
library(htmltools)
library(tidyverse)
```


```{r warning=FALSE, comment=NA, message=FALSE, echo=FALSE}
#channel.c<-odbcDriverConnect("Driver={Microsoft Access Driver (*.mdb, *.accdb)};
 #                            DBQ=R:\\ABDR\\Analysis_New\\ABDR_CASECONF\\CaseConfProb.accdb")
#CPROB<-subset(sqlQuery(channel.c,"SELECT * FROM CaseConfProb1")) 

#load current ABDR,BVS, & Conf files: update these files each year
load("R:/ABDR/Research_Data_tables/ResearchTables2007_2017/ABDR_BTH_0717RSRCH_L3.Rda") #

# Loading Birth Certificate data
load("R:\\ABDR\\Research_Data_tables\\ResearchTables2007_2017\\bth07_17.Rda")   #

# Loading ABDR data with NatCond variable
load("R:\\ABDR\\Research_Data_tables\\ResearchTables2007_2017\\ABDR_0717YOR_YOB.Rda") #

load("R:\\ABDR\\Analysis_New\\ABDR_CASECONF\\CPROB.Rda") 
CPROB$NatCond<-as.character(CPROB$NatCond)
CPROB$NatCond[CPROB$NatCond=="GASTR"]<-"GAS"
#Function to Create condition specific dataset from the ABDR and bth files
  DAT <- function(DCODE, ABDRdata, VSdata){
  cdton <- ddply(subset(ABDRdata, NatCond == DCODE & age_y<3),.(BC),summarise,
                 FYOB=min(YOB))
    dta <- join(VSdata, cdton, by='BC', type='left', match='first') 
    dta$CD <- with(dta, ifelse(is.na(FYOB), 0,1)) 
    dta <- dta[which(!is.na(dta$PH_REGION)), ] #Resident mothers only
}

# Specify the National Condition Code to be used
  code <- "GAS"
# Create a label for the condition to be used
  condition <- ("Gastroschisis")
#Specify the condition specific dataset for the condition report
  CDATA <- as.data.frame(DAT(code, ABDR_0717YOR_YOB, bth07_17))                 #
#Specify the years of these data
  datYRS <- ("2007-2017")                                                       #
#Specify the row-names for moving averages
 rnames=c("2007-2009","2008-2010","2009-2011","2010-2012","2011-2013",
          "2012-2014", "2013-2015", "2014-2016", "2015-2017")                   #
  
### Condition Specific Report coding ####
### Create Prevalence estimates by year
  ev <- addmargins(table(CDATA[,"CD"] == 1, year(CDATA[,"dob"]), 
                         useNA = "always"))
  
  #remove the NA values from the summary table
  ev <- ev[-3,][,-c(length(colnames(ev))-1)] 
  row.names(ev) <- c("NoDefect", "Defect", "Total")
  cp <- subset(CPROB,NatCond == code ,
               select = c("NatCond","ReportsSens","Confirmed","PPV","NPV"))
  Rrate <- ev[2,]/ev[3,] #Reported prevalence rate by year
 
  # estimated Prevalence
  temp1 <- ((Rrate)*cp$PPV) + ((1-(Rrate))*(1-cp$NPV))                          # Bayes adjusted prevalence rate
    ev1 <- pois.exact(temp1*ev[3,],ev[3,]) # Obtain CI's
    ev1[,3:5]<- round(ev1[,3:5]*10000,1)
    ev1[,1] <- round(ev1[,1],1)
    ev2 <- cbind(ev[2,],ev1[,-6])
    ev2 <- format(round(ev2,1), trim=T, justify="centre", drop0trailing=F)
    ev2$`Prevalence (95% CI)` <- paste(ev2[,4], paste("(", ev2[,5],","," ",
                                                      ev2[,6],")",sep = ""))
    # ev2$`Prevalence (95% CI)` <- sprintf("%1.1f (%1.1f, %1.1f)", ev2[,4], 
    # ev2[,5],ev[,6])
    colnames(ev2) <- c("Reports","Defects","Births","Defect Prevalence",
                       "LowerCI","UpperCI", "Prevalence (95% CI)")
    rownames(ev2) <- c(min(year(CDATA[,"dob"])):max(year(CDATA[,"dob"])),
                       "Total")
    ev2$yrs <- c(min(year(CDATA[,"dob"])):max(year(CDATA[,"dob"])), NA)

    #ev2 Prevalence estimate table

```
  


<center>
```{r, warning=FALSE, comment=NA, message=FALSE, echo=FALSE, fig.width = 8, fig.height = 6} 
library(GISTools)
library(rgdal)
library(grid)
library(tidyverse)
library(haven)
library(sf)
library(plotly)
library(DT)

#### Loading BVS and PFD dataframes ############################################
# Importing vital statistics data
# BVS #
fp_vs03 <- file.path("R:\\ResData\\BVS MASTER FILES\\AUTHORIZED RESEARCHERS ONLY\\current\\_03_birth.sas7bdat")
vs03 <- read_sas(fp_vs03)

fp_vs89 <- file.path("R:\\ResData\\BVS MASTER FILES\\AUTHORIZED RESEARCHERS ONLY\\current\\_89_birth.sas7bdat")
vs89 <- read_sas(fp_vs89)


#### Creating the bvs dataset with all geo-variables ####
bvs89 <- vs89 %>% 
  dplyr::select(birth_certificate_number, res_census_code, 
                         birth_village_geocode, MOTHER_RES_ZIP, 
                         MOTHER_RES_ADDR1)
#### Creating the bvs portion of a Linkage dataset ####
bvs03 <- vs03 %>% 
  dplyr::select(birth_certificate_number, res_census_code, 
                         birth_village_geocode, MOTHER_RES_ZIP, 
                         MOTHER_RES_ADDR1)

bvs_geo <- rbind(bvs89, bvs03) %>%
 # dplyr::mutate_all(.funs = as.character) %>%
  dplyr::rename("BC" = birth_certificate_number)

# Joining CDATA with bvs_geo
CDATA_geo <- left_join(CDATA, bvs_geo, by = "BC")

   ##Create map PH_REGION
  em<-addmargins(table(CDATA_geo[,"CD"]==1,CDATA[,"PH_REGION"],useNA = "always"))
    em<-em[-3,]
    row.names(em)<-c("NoDefect","Defect","Total")
    em<-em[,c(-8,-9)]
  RRrate<-em[2,]/em[3,] #Reported prevalence region
 # estimated Prevalence
  temp2<-((RRrate)*cp$PPV)+((1-(RRrate))*(1-cp$NPV))
  em1<-pois.exact(temp2*em[3,],em[3,]) #Obtain CI's
   em1[,3:5]<-round(em1[,3:5]*10000,1)
    em2<-cbind(em[2,],em1[,-6])
    colnames(em2)<-c("Reports","Defects","Births","Defect Prevalence","LowerCI","UpperCI")
      em2$`Prevalence (95% CI)`<-paste(em2[,4],paste("(",em2[,5],","," ",em2[,6],")",sep = ""))
  em2$PH_REGION<-c("Anchorage Municipality","Gulf Coast","Interior","Matanuska-Susitna Borough","Northern","Southeast","Southwest")

# Building two-by-two table for fisher exact
  # Selecting just defects and births from em2 
  defect_births <- em2 %>%
    dplyr::select(Defects, Births) 
  
  # Saving defect_births as ph_region_totals for res_census reference (line 393) 
  ph_region_totals <- defect_births %>%
    dplyr::rename("reg_defects" = Defects, "reg_births" = Births) %>%
    mutate(region = row.names(defect_births))
   
  # Calculating totals of defects and births
   defect_births_total <- defect_births %>%
     summarise_all(.funs = sum)

   # Removing row names     
  row.names(ph_region_totals) <- c(1:nrow(defect_births))
   
  #  f_tlb <- function(df){
  #    ref_defects <- defect_births_total$Defects - df[,1]
  #    ref_pop <- defect_births_total$Births - df[,2]
  #    fisher_tbl <- tibble()
  #    fisher_tbl[1,1] <- df[,1]
  #     fisher_tbl[1,2] <- df[,2]
  #      fisher_tbl[2,1] <- ref_defects
  #      fisher_tbl[2,2] <- ref_pop
  #      fish <- fisher.test(x = fisher_tbl)
  #      return(fish)
  # }
   
  # Looping over all 7 rows of defect_births to calculate reference defects and
   # births
  output1 <- vector("double", length(defect_births))
  output2 <- vector("double", length(defect_births))
  output3 <- vector("double", length(defect_births))
  output4 <- vector("double", length(defect_births))
  for (i in 1:nrow(defect_births)) {
    output1[i] <- defect_births[i, 1] 
    output2[i] <- defect_births[i, 2]
    output3[i] <- defect_births_total$Defects - defect_births[i , 1] 
    output4[i] <- defect_births_total$Births - defect_births[i , 2]
  }
  
# Creating tibble of defects and births with references
inter_tbl <- tibble(output1, output2, output3, output4)
colnames(inter_tbl) <- c("defects", "Births", "ref_defects", "ref_births")

# Creating a list of 2x2 tables (matrix) for every local 
output_matrix <- list(matrix(nrow = 2, 
                        ncol = 2))
# output_fisher <- list()
for (i in 1:nrow(inter_tbl)) {
  output_matrix[i] <- list(matrix(inter_tbl[i, ],
                        nrow = 2, 
                        ncol = 2, dimnames = list(c("defects", "births"), 
                                       c("local", "reference"))))
  # output_fisher[[i]] <- fisher.test(output_matrix[[i]])
}


# Trying to loop fisher.test over list of local matrices
# Turning list of matrices into "proper" matrices
fish <- lapply(output_matrix, FUN = as.matrix.data.frame)

# Looping fisher exact test over list of matrices
fish2 <- lapply(fish, FUN = fisher.test)

# Adding names to fish2 lists
names(fish2) <- em2$PH_REGION

# Creating matrices of specific fisher exact test results
p_value <- matrix(lapply(fish2, function(x){x$p.value}), nrow = nrow(em2))
odds_ratio <-  matrix(lapply(fish2, function(x){x[[3]]}), nrow = nrow(em2))
conf_int <-  matrix(lapply(fish2, function(x){x[[2]]}), nrow = nrow(em2))
clr <-  matrix(lapply(fish2, function(x){x[[2]][[2]]/ x[[2]][[1]]}), 
               nrow = nrow(em2))

# Creating a tibble of the fisher extact test results
fish_results <- tibble(em2$PH_REGION, unlist(p_value[, 1]), 
                       unlist(odds_ratio[, 1]), unlist(clr[, 1]))
colnames(fish_results) <- c("region", "p_value", "odd_ratio", 
                            "conf_limit_ratio")

# Joining em2 and fish_results: em3
em2b <- left_join(em2, fish_results, by = c("PH_REGION" = "region")) %>%
  dplyr::rename("Adjusted Defect Estimate" = Defects)

# Reorganizing column order
em2b <- em2b[, c("Reports", "Adjusted Defect Estimate", "Births", 
               "Defect Prevalence", "LowerCI", "UpperCI", 
               "Prevalence (95% CI)", "p_value", 
               "odd_ratio", "conf_limit_ratio", "PH_REGION")]
row.names(em2b) <- rownames(em2)




################################################################################
 ##Create map res_census_code
#   em<-addmargins(table(CDATA_geo[,"CD"]==1,CDATA_geo[,"res_census_code"],
#                        useNA = "always"))
#     em<-em[-3,]
#     row.names(em)<-c("NoDefect","Defect","Total")
#   RRrate<-em[2,]/em[3,] #Reported prevalence region
#  # estimated Prevalence
#   temp2<-((RRrate)*cp$PPV)+((1-(RRrate))*(1-cp$NPV))
#   temp2 <- temp2[c(-36, -37)]
#   em <- em[ , c(-36, -37)]
#   em1<-pois.exact(temp2*em[3,],em[3,]) #Obtain CI's
#    em1[,3:5]<-round(em1[,3:5]*10000,1)
#     em2<-cbind(em[2,],em1[,-6])
#     colnames(em2)<-c("Reports","Defects","Births",
#                      "Defect Prevalence","LowerCI","UpperCI")
#       em2$`Prevalence (95% CI)`<-paste(em2[,4],
#                                        paste("(",em2[,5],","," ",em2[,6],")",
#                                              sep = ""))
#   em2$res_census<- row.names(em2)
# 
# # creating a conversion matrix between census code and Public health region
# census_matrix <- CDATA_geo %>%
#   tabyl(res_census_code, PH_REGION)
# 
# # Creating a master list of census codes and Public health regions
# census_codes_master <- census_matrix %>%
#   subset(select = 2:8) %>% 
#   mutate(mak = do.call(pmax, (.))) %>%                                          # Taking the maximum res_census_code-residence_census pairing 
#   dplyr::select(mak) %>% 
#   cbind(census_matrix) %>%                                                      # as the true (correct coding).
#   gather(-c(mak, res_census_code), key = "region", value = "numbers") %>%
#   filter(mak == numbers) %>%
#   dplyr::select(res_census_code, region) %>%
#   rename("res_census" = res_census_code)
#   
#   
#  defect_births <- em2 %>%
#     dplyr::select(Defects, Births, res_census) %>%
#    left_join(census_codes_master, by = "res_census") %>%
#    left_join(ph_region_totals, by = "region")
#    
#   # Calculating totals of defects and births
#    # defect_births_total <- defect_births %>%
#    #   summarise_all(.funs = sum)                                                
#    
#   # Looping over all 7 rows of defect_births to calculate reference defects and
#    # births
#   output1 <- vector("double", length(defect_births))
#   output2 <- vector("double", length(defect_births))
#   output3 <- vector("double", length(defect_births))
#   output4 <- vector("double", length(defect_births))
#   for (i in 1:nrow(defect_births)) {
#     output1[i] <- defect_births[i, 1] 
#     output2[i] <- defect_births[i, 2]
#     output3[i] <- defect_births$reg_defects[i] - defect_births[i , 1] 
#     output4[i] <- defect_births$reg_births[i] - defect_births[i , 2]
#   }  
#   
# # Creating tibble of defects and births with references
# inter_tbl <- tibble(output1, output2, output3, output4)
# colnames(inter_tbl) <- c("defects", "Births", "ref_defects", "ref_births")
# 
# # Creating a list of 2x2 tables (matrix) for every local 
# output_matrix <- list(matrix(nrow = 2, 
#                         ncol = 2))
# # output_fisher <- list()
# for (i in 1:nrow(inter_tbl)) {
#   output_matrix[i] <- list(matrix(inter_tbl[i, ],
#                         nrow = 2, 
#                         ncol = 2, dimnames = list(c("defects", "births"), 
#                                        c("local", "reference"))))
#   # output_fisher[[i]] <- fisher.test(output_matrix[[i]])
# }
# 
# 
# # Trying to loop fisher.test over list of local matrices
# # Turning list of matrices into "proper" matrices
# fish <- lapply(output_matrix, FUN = as.matrix.data.frame)
# 
# # Looping fisher exact test over list of matrices
# fish2 <- lapply(fish, FUN = fisher.test)
# 
# # Adding names to fish2 lists
# names(fish2) <- em2$res_census
# 
# # Creating matrices of specific fisher exact test results
# p_value <- matrix(lapply(fish2, function(x){x$p.value}), nrow = nrow(em2))
# odds_ratio <-  matrix(lapply(fish2, function(x){x[[3]]}), nrow = nrow(em2))
# conf_int <-  matrix(lapply(fish2, function(x){x[[2]]}), nrow = nrow(em2))
# clr <-  matrix(lapply(fish2, function(x){x[[2]][[2]]/ x[[2]][[1]]}), 
#                nrow = nrow(em2))
# 
# # Creating a tibble of the fisher extact test results
# fish_results <- tibble(em2$res_census, unlist(p_value[, 1]), 
#                        unlist(odds_ratio[, 1]), unlist(clr[, 1]))
# colnames(fish_results) <- c("census_code", "p_value", "odd_ratio", 
#                             "conf_limit_ratio")
# 
# ################################################################################
# 
# ################################################################################
#  ##Create map mother resitdent zip code                                         # Zip Code reference population is current the rest of the state
#   em<-addmargins(table(CDATA_geo[,"CD"]==1,CDATA_geo[,"MOTHER_RES_ZIP"],
#                        useNA = "always"))
#     em<-em[-3,]
#     row.names(em)<-c("NoDefect","Defect","Total")
#     em<-em[,c(-8,-9)]
#   RRrate<-em[2,]/em[3,] #Reported MOTHER_RES_ZIP
#  # estimated Prevalence
#   temp2<-((RRrate)*cp$PPV)+((1-(RRrate))*(1-cp$NPV))
#   temp2 <- temp2[c(-598, -599)]                                                 #
#   em <- em[ , c(-598, -599)]                                                    #
#   em1<-pois.exact(temp2*em[3,],em[3,]) #Obtain CI's
#    em1[,3:5]<-round(em1[,3:5]*10000,1)
#     em2<-cbind(em[2,],em1[,-6])
#     colnames(em2)<-c("Reports","Defects","Births",
#                      "Defect Prevalence","LowerCI","UpperCI")
#       em2$`Prevalence (95% CI)`<-paste(em2[,4],
#                                        paste("(",em2[,5],","," ",em2[,6],")",
#                                              sep = ""))
#   em2$MOTHER_RES_ZIP <- row.names(em2)
# 
#  defect_births <- em2 %>%
#     dplyr::select(Defects, Births) 
#    
#   # Calculating totals of defects and births
#    defect_births_total <- defect_births %>%
#      summarise_all(.funs = sum)
#    
#   # Looping over all 7 rows of defect_births to calculate reference defects and
#    # births
#   output1 <- vector("double", length(defect_births))
#   output2 <- vector("double", length(defect_births))
#   output3 <- vector("double", length(defect_births))
#   output4 <- vector("double", length(defect_births))
#   for (i in 1:nrow(defect_births)) {
#     output1[i] <- defect_births[i, 1] 
#     output2[i] <- defect_births[i, 2]
#     output3[i] <- defect_births_total$Defects - defect_births[i , 1] 
#     output4[i] <- defect_births_total$Births - defect_births[i , 2]
#   }  
#   
# # Creating tibble of defects and births with references
# inter_tbl <- tibble(output1, output2, output3, output4)
# colnames(inter_tbl) <- c("defects", "Births", "ref_defects", "ref_births")
# 
# # Creating a list of 2x2 tables (matrix) for every local 
# output_matrix <- list(matrix(nrow = 2, 
#                         ncol = 2))
# # output_fisher <- list()
# for (i in 1:nrow(inter_tbl)) {
#   output_matrix[i] <- list(matrix(inter_tbl[i, ],
#                         nrow = 2, 
#                         ncol = 2, dimnames = list(c("defects", "births"), 
#                                        c("local", "reference"))))
#   # output_fisher[[i]] <- fisher.test(output_matrix[[i]])
# }
# 
# 
# # Trying to loop fisher.test over list of local matrices
# # Turning list of matrices into "proper" matrices
# fish <- lapply(output_matrix, FUN = as.matrix.data.frame)
# 
# # Looping fisher exact test over list of matrices
# fish2 <- lapply(fish, FUN = fisher.test)
# 
# # Adding names to fish2 lists
# names(fish2) <- em2$MOTHER_RES_ZIP                                              #
# 
# # Creating matrices of specific fisher exact test results
# p_value <- matrix(lapply(fish2, function(x){x$p.value}), nrow = nrow(em2))
# odds_ratio <-  matrix(lapply(fish2, function(x){x[[3]]}), nrow = nrow(em2))
# conf_int <-  matrix(lapply(fish2, function(x){x[[2]]}), nrow = nrow(em2))
# clr <-  matrix(lapply(fish2, function(x){x[[2]][[2]]/ x[[2]][[1]]}), 
#                nrow = nrow(em2))
# 
# # Creating a tibble of the fisher extact test results
# fish_results <- tibble(em2$MOTHER_RES_ZIP, unlist(p_value[, 1]),                #
#                        unlist(odds_ratio[, 1]), unlist(clr[, 1]))
# colnames(fish_results) <- c("mom_zip", "p_value", "odd_ratio",                  #
#                             "conf_limit_ratio")

################################################################################ 
#read in Shape file

#sf
ak_sf <- st_read(dsn="R:\\ABDR\\Analysis_New\\ABDR_CASECONF\\shapefiles",
                 layer="PHR", 
                 quiet = TRUE)

#sp
AK<-readOGR(dsn="R:\\ABDR\\Analysis_New\\ABDR_CASECONF\\shapefiles",layer="PHR",verbose=FALSE)

#Merge shape file with regionally summary table
AK@data = data.frame(AK@data, em2b[match(AK@data$XAPHR_LBL,em2b$PH_REGION),])
#set cut points based on quintiles
# ApplyQuintiles <- function(x) {
#   cut(x, breaks=c(quantile(AK$Defect.Prevalence, probs = seq(0, 1, by = 0.20))), 
#        labels=c("0-19","20-39","40-59","60-79","80-100"),include.lowest=TRUE)
# }
# AK$Quintile <-sapply(AK$Defect.Prevalence, ApplyQuintiles)
# AK[AK$Reports<6]<-NA
# AK[AK$Adjusted.Defect.Estimate<6]<-NA

spplot(AK["Defect.Prevalence"],
       scales=list(draw = FALSE), cuts = 6,
       legendEntries = c(as.character(em2b$`Defect Prevalence`)),
       colorkey=list(space = "left"), 
       par.settings=list(axis.line=list(col='transparent')),
       col.regions=brewer.pal(7, "YlOrBr"))

# grid.text("Adjusted Defect Estimates*",x=unit(0.87,"npc"),
#           y=0.92,gp=gpar(fontsize=9))
grid.text("Adjusted Regional Prevalence Estimates.",
          x=unit(0.81,"npc"),y=0.94,gp=gpar(fontsize=10.75))
grid.text("*Visual differences between regions may not reflect statistical differences.",
          x=unit(0.71,"npc"),y=0.05,gp=gpar(fontsize=8.75))
grid.text("Northern",x=unit(0.59,"npc"),y=0.76,gp=gpar(fontsize=9))
grid.text("Interior",x=unit(0.65,"npc"),y=0.60,gp=gpar(fontsize=9))
grid.text("Anchorage",x=unit(0.83,"npc"),y=0.52,gp=gpar(fontsize=9))
grid.text("Mat-Su",x=unit(0.67,"npc"),y=0.49,gp=gpar(fontsize=9))
grid.text("Southwest",x=unit(0.57,"npc"),y=0.43,gp=gpar(fontsize=9, col = "white"))
grid.text("Southeast",x=unit(0.85,"npc"),y=0.31,gp=gpar(fontsize=9))
grid.text("Gulf Coast",x=unit(0.73,"npc"),y=0.40,gp=gpar(fontsize=9))
grid.lines(x=c(0.68,0.82),y=c(0.46,0.51),gp=gpar(lwd=1))


#Create regional summary table to display
    #Suppression
em3<-em2b
      em3[em3$Reports<6,c(1:2,4:8)]<-0
      sup1<-apply(em3,1, function(y){ ifelse(0 %in% y, 1, 0)})
      sup2<-1 %in% sup1
      sup3<-sum(sup1)
      if(sup2=="TRUE" & sup3<2){
        em3[1,c(1:2)]<-0
      }
      em3[em3==0]<-'-' 
      
     
      em3 <- em3 %>%
        dplyr::select(-c(conf_limit_ratio, PH_REGION))
      em3 <- em3[ , c("Reports", "Adjusted Defect Estimate", "Births",
                      "Defect Prevalence", "LowerCI", "UpperCI", 
                      "Prevalence (95% CI)", "odd_ratio", "p_value")]
      
       em3 <- em3 %>%
        dplyr::rename("Odds Ratio" = odd_ratio, 
               "P-Value" = p_value)
   
# Datatable table       
# tmp2 <- datatable(data = as.data.frame(txtRound(em3[,-c(4:6)],1,excl.cols = c(1,3,4,6),txt.NA = "-") %>%
#                  txtRound(2, excl.cols = c(1:5))),extensions = c("Buttons"), 
#           caption = "notessss")   
#       
       
# tmp2 <- htmltools::withTags(table(
#   tableHeader(tmp2),
#   tableFooter(paste0("Notes:Prevalence reported per 10,000 live births; Data suppressed for # of reports  < 6; 95% CI = 95% Confidence Interval"))
#   )
# )

tmp2 <- txtRound(em3[,-c(4:6)],1,excl.cols = c(1,3,4,6),txt.NA = "-") %>%
                 txtRound(2, excl.cols = c(1:5))

#Make table   
tmp<-htmlTable(tmp2,
          css.cell="padding-left: 2em; padding-right: 2em;",
          tfoot="Notes:Prevalence reported per 10,000 live births; Data suppressed for # of reports  < 6; 95% CI = 95% Confidence Interval")
#gsub('<td','<td nowrap="nowrap";',tmp) #removes wrapping
       
# #Make table   
# tmp<-htmlTable(txtRound(em3[,-c(4:6)],1,excl.cols = c(1,3,4,6),txt.NA = "-"),
#           css.cell="padding-left: 2em; padding-right: 2em;",
#           tfoot="Notes:Prevalence reported per 10,000 live births; Data suppressed for # of reports  < 6; 95% CI = 95% Confidence Interval")
# #gsub('<td','<td nowrap="nowrap";',tmp) #removes wrapping


datatable(tmp2, container = tmp, rownames = T)



  ##Create map res_census_code       
  # em_res_census <-addmargins(table(CDATA_geo[,"CD"]==1,
  #                                  CDATA_geo[,"res_census_code"],
  #                                  useNA = "always"))
  #   em_res_census <- em_res_census[-3,]
  #   row.names(em_res_census)<-c("NoDefect","Defect","Total")
  #   em_res_census<-em_res_census[,c(-8,-9)]
  # RRrate_res_census <- em_res_census[2,]/em_res_census[3,] #Reported prevalence region
  # 

# library(mapview)
# mapview(AK@data, zcol = AK@data["Defect.Prevalence"], legend = TRUE, xcol = , ycol = )


```
  

</center>  
### Demographics
Some subgroups may be more at risk for having a baby with `r condition[1]`. This section provides the descriptive epidemiology of specified maternal, birth, and child characteristics identified from the birth certificate.  
  
<center>  
```{r warning=FALSE,echo=FALSE, message=FALSE, results="asis"}
library(dplyr)
levels(CDATA$BWT_G)<-c("<2500","2500+")
CDATA$M_EDU<-(as.factor(CDATA$M_EDU))
levels(CDATA$M_EDU)<-c("<12","12","12+")
levels(CDATA$eligible)<-c("Enrolled","Not enrolled")
CDATA$smoking_status<-relevel(as.factor(CDATA$smoking_status),ref="Reported smoking")
#CDATA$substance<-relevel(as.factor(CDATA$substance),ref="Yes")

COND_FCTR<-function(Code2,Factor,data){
  ga<-addmargins(table(data[,"CD"]==1,data[,Factor],useNA = "always"))
  ga<-ga[-3,][,-c(max(length(colnames(ga)))-1,max(length(colnames(ga))))]
    row.names(ga)<-c("NoDefect","Defect","Total")
  cp<-subset(CPROB,NatCond==Code2,select=c("NatCond","ReportsSens","Confirmed","PPV","NPV"))
  Rrate<-ga[2,]/ga[3,] #Reported prevalence rate by year
  temp1<-((Rrate)*cp$PPV)+((1-(Rrate))*(1-cp$NPV))
    ga1<-pois.exact(temp1*ga[3,],ga[3,]) #Obtain CI's
    ga1[,3:5]<-round(ga1[,3:5]*10000,2)
    #ga1<-ga1[,-6]
    row.names(ga1)<-colnames(ga) 
  ga2<-cbind(ga[2,],ga1[,-6])
    colnames(ga2)<-c("Reports","Defects","Births","Defect Prevalence","LowerCI","UpperCI")
  #ga2[ga2$Reports<5,]<-NA
  ga2
}
d1<-COND_FCTR(code,"sex",CDATA)
d2<-COND_FCTR(code,"BWT_G",CDATA)
d3<-COND_FCTR(code,"M_grp",CDATA)
d4<-COND_FCTR(code,"M_rce",CDATA)
d5<-COND_FCTR(code,"M_EDU",CDATA)
d6<-COND_FCTR(code,"marital_status",CDATA)
d8<-COND_FCTR(code,"smoking_status",CDATA)
d11<-COND_FCTR(code,"eligible",CDATA)
d12<-COND_FCTR(code,"DName",CDATA)

###Make the combined Demographic table

t1a<-rbind(d1,d2,d3,d4,d5,d6,d8,d11,d12)
  t2<-as.data.frame(data.matrix(t1a))
    t2[,c(2,4:6)]<-round(t2[,c(2,4:6)],1)
    t2[,c(2,4:6)]<-format(t2[,c(2,4:6)],drop0trailing = FALSE,trim = T)
    t2$`Prevalence (95% CI)`<-paste(t2[,4],paste("(",t2[,5],","," ",t2[,6],")",sep = ""))
  t3<-t2[,-(4:6)]  
  t3$grp<-rep(1:9,c(2,2,6,4,3,2,2,2,2))
  t3$vlu<-c(1:25)
  t3$num <- ave(t3$Reports, t3$grp, FUN = seq_along)
#Suppression rules
  t4<-merge(t3,t3[t3$Reports<6,c("grp","Reports")],by=c("grp"),all.x=T)
  t5<-t4[!duplicated(t4[,1:7]),]
   t5<-ddply(t5,.(grp),transform,count = length(grp))
    t5<-t5[order(t5$vlu),]
   rownames(t5)<-rownames(t3)
    t5[is.na(t5$Reports.y),"Reports.y"]<-10
      t5[t5$Reports.x <6 & t5$Reports.y<6,c(5:8)]<-0
      t5$sup1<-with(t5,ifelse(Prevalence..95..CI.== '0',1,0))
      t5<-ddply(t5,.(grp),transform,sup2 = sum(sup1))
      rownames(t5)<-rownames(t3)
      t5$dif<-t5$count-t5$sup2
      t5 <- t5 %>% dplyr::group_by(grp) %>%
        dplyr::mutate(rank = rank(Reports.x, ties.method = "random"))
      t5$sup<-ifelse(t5$sup1==0 & t5$count==2 & t5$dif < 2,0,
              ifelse(t5$sup1==0 & t5$count==2 & t5$dif == 2,1,
                ifelse(t5$sup1==0 & t5$count==6 & t5$dif == 5 &
                       t5$rank <= 2.5, 0, 
                ifelse(t5$sup1==0 & t5$count==6 & t5$dif == 4,1,
                ifelse(t5$sup1==0 & t5$count==6 & t5$dif == 3,1,
                ifelse(t5$sup1==0 & t5$count==6 & t5$dif == 2,1,      
                ifelse(t5$sup1==0 & t5$count==6 & t5$dif == 1,1,   
                ifelse(t5$sup1==0 & t5$count==6 & t5$dif == 6,1,
                  ifelse(t5$sup1==0 & t5$count==4 & t5$dif == 3 & 
                           (t5$rank == 1 | t5$rank == 2), 0,
                  ifelse(t5$sup1==0 & t5$count==4 & t5$dif == 2,1,
                  ifelse(t5$sup1==0 & t5$count==4 & t5$dif == 1,1,
                  ifelse(t5$sup1==0 & t5$count==4 & t5$dif == 4,1,
                    ifelse(t5$sup1==0 & t5$count==3 & t5$dif ==2,0,
                    ifelse(t5$sup1==0 & t5$count==3 & t5$dif ==1,1,
                    ifelse(t5$sup1==0 & t5$count==3 & t5$dif ==3,1,9)
                    ))))))))))))))                                              #
      t5 <- t5 %>% mutate_at(.vars = c(2:4, 6:14), .funs = as.numeric)          #
      t5[t5$Reports.x <6 & t5$Reports.y<6,c(1:3,6:8)]<- 0 
      t5[(t5$sup==0),c(1:3)]<-0
            t5 <- t5 %>% mutate_all(.funs = as.character)
            t5 <- t5 %>% mutate_at( 
                             .vars = c(2,3,5:14),
                             funs(ifelse(. == "0", "-", .)))
   # t5[t5 == "0"] <- '-'                                                       # 
    t6<-t5[-c(1,6:14)]                                                          #
    rownames(t6)<-rownames(t3)                                                  #
      colnames(t6)[1]<-"Reports"
      colnames(t6)[4]<-"Prevalence (95% CI)" 

 demo_groups <- c("Sex", "Sex", 
                  "Birth weight (grams)", "Birth weight (grams)",
                  "Maternal age", "Maternal age", "Maternal age", 
                  "Maternal age", "Maternal age", "Maternal age",
                  "Maternal race", "Maternal race", "Maternal race",
                  "Maternal race", 
                  "Maternal education (years)",
                  "Maternal education (years)", 
                  "Maternal education (years)",
                  "Marital status",
                  "Marital status", 
                  "Maternal smoking use",
                  "Maternal smoking use",
                  "Medicaid (mother or child)",
                  "Medicaid (mother or child)",
                  "Father on birth certificate", 
                  "Father on birth certificate") %>%
   data_frame()
   names(demo_groups) <- "de_groups"
 
 t7 <- bind_cols(t6, demo_groups)
     
      
      tmp1<-htmlTable(t6,
                rgroup=c("Sex","Birth weight (grams)","Maternal age",
                         "Maternal race",
                         "Maternal education (years)","Marital status",
                         "Maternal smoking use",
                         "Medicaid (mother or child)",
                         "Father on birth certificate"),
                n.rgroup=c(2,2,6,4,3,2,2,2,2),
                css.cell="padding-left: 2em; padding-right: 2em;",
                tfoot=txtMergeLines("Notes: Prevalence reported per 10,000 live births; Data suppressed for # of reports  < 6; 95% CI = 95% Confidence Interval"))
#gsub('<td','<td nowrap="nowrap";',tmp1) #removes wrapping
      
      
# datatable(t6,
#           extensions = "RowGroup",
#           options = list(rowGroup = list(c("Sex","Birth weight (grams)","Maternal age",
#                          "Maternal race",
#                          "Maternal education (years)","Marital status",
#                          "Maternal smoking use",
#                          "Medicaid (mother or child)",
#                          "Father on birth certificate")), 
#                          columnDefs = list(list(visible=FALSE, targets=c(2,2,6,4,3,2,2,2,2)))),
#           container = tmp1, 
#           rownames = T)
# 
# 
datatable(t7,
          extensions = c("RowGroup", "Responsive"),
           options = list(rowGroup = list(dataSrc = 5), 
                          pageLength = 30),
          container = tmp1,
          rownames = T, 
          class = 'cell-border stripe')
# https://rstudio.github.io/DT/extensions.html
```  

</center>

### Accompanying Diagnoses
The ten diagnoses most commonalty associated with `r condition[1]`. 

<center>  
```{r warning=FALSE, comment=NA,message=FALSE, echo=FALSE, fig.width = 9, fig.height = 6} 
load("R:/ABDR/Analysis_New/Published Data/secondary_diag_plots.Rda")



sec_ii <- secondary_diag_plots[[paste0(code)]]
sec_ii[["x"]][["data"]][[1]][["text"]] <- paste(
                                               "<br>ICD-10 Description: ", sec_ii[["x"]][["layout"]][["yaxis"]][["ticktext"]],
                                               # "<br>Number of diagnoses: ", other_diag,
                                               "<br>Percentage of cases: ", sec_ii[["x"]][["data"]][[1]][["width"]])

sec_ii

```
</center>

___
## Technical notes  
### Column descriptions  
**# Reports:** Unless otherwise noted, the number of unique reports of the defect received by ABDR during the specified birth year(s). Each report represents a unique child with the specified defect.  

**# Defects:** The estimated true number of reports that are diagnosed defects based on medical record review and case confirmation.  

**# Births:** The number of live births among Alaskan residents that occurred in Alaska during the specified birth year(s).  

**Prevalence (95% CI):** The estimated diagnosed prevalence of the condition and corresponding 95% Confidence Interval. (For information on how the defect prevalence was estimated see below).   

### Defect prevalence calculation
The estimated defect prevalence was calculated using a Bayesian approach based on the reported prevalence, PPV and 1-NPV (see formula below).

Through medical records review and case confirmation of a random sample of reported cases, the defect prevalence is calculated as: 

$$PPV (Positive Predictive Value) = p(defect|report)$$
$$NPV (Negative Predictive Value) = p(\overline{defect}|\overline{report})$$

$$p(defect) \approx [p(report)\cdot PPV]+[p(\overline{report})\cdot (1-NPV)]$$   

Defect prevalence estimates are a more accurate estimation of the actual diagnosed prevalance of birth defects compared to the reported prevalance estimates in Alaska. ABDR obtains reports from medical providers using International Classification of Disease (ICD) codes that are extracted from individual systems which when aggregated may not reflect true diagnostics. Caution should be used when interpreting and comparing the reported prevalence estimates with national estimates.  

See [Data analysis methods](http://dhss.alaska.gov/dph/wcfh/Documents/mchepi/abdr/Data%20Analysis%20Methods_v2.1.pdf) for more information.

### P-value estimate  
To evaluate the trend over time and account for under/over-dispersion we constructed a quasi-Poisson regression model. This model assumes the variance is a linear function of the mean and models the estimated number of annual defects by year with a natural log (ln) offset of the annual births. P-values < 0.05 are considered significant, which indicates that the predicted slope is significantly different from a slope of zero.     

### Data suppression
For region and demographic data tables, values are suppressed based on the number of reports received during the observation period. Counts less than 6 are suppressed (as indicated by '-' in the table). For regions or demographics with only one cell count suppressed a second is suppressed to eliminate the ability to back-calculate the estimate.   

## References
[[1]]( https://www.cdc.gov/ncbddd/birthdefects/gastroschisis.html#ref) Centers for Disease Control and Prevention. Facts about Gastroschisis, https<span></span>://www.cdc.gov/ncbddd/birthdefects/gastroschisis.html#ref; 2015 [accessed 02.23.2017]  

[[2]]( http://onlinelibrary.wiley.com/doi/10.1002/tera.1420470306/full) Haddow J, Palomaki G, Holman M. Young maternal age and smoking during pregnancy as risk factors for gastroschisis. Teratology 1993; 47(3):225-228.  

[[3]]( https://www.ncbi.nlm.nih.gov/pubmed/19635303) Mac Bird T, Robbins JM, Druschel C, Cleves MA, Yang S, Hobbs CA. Demographic and environmental risk factors for gastroschisis and omphalocele in the National Birth Defects Prevention Study. Journal of Pediatric Surgery 2009; 44(8):1546-51  

[[4]](https://www.cdc.gov/mmwr/volumes/65/wr/mm6502a2.htm) Jones AM, Isenburg J, Salemi JL, et al. Increasing Prevalence of Gastroschisis - 14 States, 1995-2012. MMWR Morb Mortal Wkly Rep 2016;65:23-26.  

[[5]]( https://www.cdc.gov/ncbddd/birthdefects/data.html) Centers for Disease Control and Prevention, Birth Defects Data and Statistics, https<span></span>://www.cdc.gov/ncbddd/birthdefects/data.html; 2016 [accessed 02.23.2017]    


## Resources 
[Centers for Disease Control and Prevention](https://www.cdc.gov/ncbddd/birthdefects/gastroschisis.html)   
[National Birth Defects Prevention Network](http://www.nbdpn.org/index.php)  

## Authorship
Maternal and Child Health (MCH) senior epidemiologist Dr. Jared Parrish, PhD conceived of the presented analysis. Alaska Birth Defects Registry program manager and epidemiologist Chris Barnett, MS MPH and Dr. Jared Parrish, PhD developed the theory and performed the computations. Research analysts Monica Mills and Jordyn Lord managed data collection and storage. All authors discussed the results and contributed to the final report.

## Suggested Citation
State of Alaska Department of Health and Social Services, Division of Public Health, Section of Women's, Children's, and Family Health. Alaska Birth Defects Registry Condition Report: Gastroschisis, Alaska, 2007-2017. Updated June 28, 2021. Available at: http://rpubs.com/AK_ABDR/Gastroschisis07_17.

## Contact    

Alaska Birth Defects Registry (ABDR)    
3601 C Street, Suite 358  
Anchorage, AK 99503  
(907) 269-3400 phone  
(907) 754-3529 fax  
hssbirthdefreg@alaska.gov    


*Updated: June 28, 2021*  
*Code source:* ```R:\ABDR\Analysis_New\ABDR_CASECONF\cond_reports\Published_reports\Gastroschisis07_17.Rmd```  

&nbsp;

 <center>
![](R:/ABDR/Reporting_Documentation/DHSS4.png "State of Alaska, Department of Health and Human Services, Section of Women's, Children's and Family Health")
</center>  

